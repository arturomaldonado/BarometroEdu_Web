---
title: "Bases de datos del Barómetro de las Américas"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    #code_folding: hide
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```

```{css color, echo=FALSE}
.columns {display: flex;}
h1 {color: #3366CC;}
```

# Introducción

Los datos que vamos a usar a lo largo de todos estos temas son los del proyecto del Barómetro de las Américas de [LAPOP Lab](https://www.vanderbilt.edu/lapop/). Como centro de excelencia en investigación por encuestas, LAPOP Lab usa enfoques y métodos innovadores con los "estándares más altos" para llevar a cabo encuestas nacionales; conducir estudios de evaluación de impacto, y producir reportes acerca de las actitudes, evaluaciones y experiencias de los individuos. El Barómetro de las Américas es la única encuesta comparativa y científicamente rigurosa que cubre 34 naciones incluyendo Norte, Centro y Sudamérica, así como también, un significativo número de países en el Caribe. Cada año publica docenas de estudios académicos de alta calidad y artículos de relevancia para la elaboración de políticas públicas. Los reportes producidos por el proyecto se pueden ver y descargar es este [link](https://www.vanderbilt.edu/lapop/publications.php).

El Barómetro de las Américas del 2018/19 es la octava ronda de este proyecto. El cuestionario contiene un módulo común que permite evaluar hasta qué punto los ciudadanos apoyan los valores democráticos, perciben que hay suficiente provisión de libertades básicas, cómo experimentan el Estado de Derecho, participan en la vida política, apoyan su sistema de gobierno, usan las redes sociales, entre otros temas. Los instrumentos generales y los específicos para cada país pueden encontrarse en este [link](https://www.vanderbilt.edu/lapop/core-surveys.php).

La base de datos y los reportes del proyecto son públicos y se encuentran disponibles de forma gratuita en la página web del proyecto.

Estos datos deben citarse de la siguiente manera: Fuente: Barómetro de las Américas por el Proyecto de Opinión Pública de América Latina (LAPOP), wwww.LapopSurveys.org.

# Para descargar los datos

Los datos se puede descargar de manera libre [aquí](http://datasets.americasbarometer.org/database/login.php). En este enlace, se pueden registrar o entrar como "Free User". En el buscador, se puede ingresar el texto "2018". Ahí se tendrá acceso a la base de datos completa "2018 LAPOP AmericasBarometer Merge_v1.0_W.dta" en versión para STATA. Se descarga la base de datos en formato zip, la que se descomprime en formato .dta.

También se puede acceder a las bases de datos de cada país. Por ejemplo, si en el buscador se ingresa el texto "Mexico", se puede acceder a las bases de datos de México para cada una de las rondas del Barómetro de las Américas en ese país. Los datos de la última ronda se pueden descargar como un archivo llamado "Mexico LAPOP AmericasBarometer 2019 v1.0_W.dta", en formato STATA. En este caso, se descarga directamente como un archivo .dta.

# Importar las bases de datos

Una vez descargados los datos, es una buena práctica crear un nuevo proyecto en RStudio. En el menú "File", se tiene la opción "New Project", donde se selecciona la opción "New directory" y "New project", donde se tiene que nombrar el proyecto y darle una ruta en el disco. Esta ruta será el directorio de trabajo donde se guardará los archivos que se vaya trabajando y produciendo. Si no queda claro cuál es la ruta seleccionada, siempre se puede visualizar el directorio de trabajo en la consola de RStudio o se puede encontrar con el comando `getwd()`. Si se desea cambiar de directorio de trabajo, se puede usar el comando `setwd()`. Por ejemplo, se podría definir:

`setwd("ruta_del_directorio_de_trabajo/directorio_de_trabajo").`

El archivo descargado se tiene que guardar en el directorio de trabajo. De esta manera, se puede leer la base de datos en STATA como un objeto dataframe en R. Hay varias maneras de leer una base de datos en R. Una primera manera es mediante el menú "File" y el submenú "Import Dataset". Dentro de esta opción se ve que se pueden importar archivos en formato text, Excel, SPSS, SAS o STATA. Si se escoge STATA, se abre una ventana donde se debe buscar la ruta del archivo. Esta ventana mostrará una previsualización de la base de datos. La base de datos muestra el nombre original por defecto, pero el nombre puede cambiarse por uno más simple.

Esta forma de importar las bases de datos se puede hacer también mediante código, lo que es recomendable cuando se tiene un Script de R o un archivo RMArkdown. De hecho, mediante el menú "Import Dataset" muestra el código que se puede aplicar para reproducir el proceso. En este caso se llama a la librería `haven` y al comando `read_stata`. Los detalles de esta librería se pueden encontrar [aquí](https://cran.r-project.org/web/packages/haven/index.html).

En esta librería también se tiene el comando `read_dta` para leer archivos de STATA o el comando `read_sav` para archivos de SPSS. En nuestro ejemplo, si el archivo sobre México en formato STATA está en el directorio de trabajo, el código para cargar este archivo como un Dataframe de R llamado "mex18" sería:

`library(haven)`

Luego

`mex18 <- read_stata("Mexico LAPOP AmericasBarometer 2019 v1.0_W.dta")`.

Tenga en cuenta que siempre se debe cargar la librería, con el comando `library`, antes de usar comandos pertenecientes a esas librarías. Si no se carga la librería antes, el código resultará en un error.

Dentro del menú "Import Dataset" también se puede cargar la librería `readxl` y el comando `read_excel` para importar archivos Excel. Finalmente, también se puede cargar la librería `readr` para leer archivos .txt.

En la sección sobre [correlación](https://arturomaldonado.github.io/BarometroEdu_Web/correlacion.html) se trabajará con datos del proyecto Varieties of Democracy (o V-Dem). Estos datos pueden ser descargados de la web del proyecto en formato .csv o .xls. Si descargamos estos datos y los guardamos en el directorio de trabajo con el nombre "vdem.xlsx", estos datos se pueden leer como un nuevo dataframe. Primero se carga la librería

`library(readxl)`

Luego la base de datos

`vdem <- read_excel("vdem.xlsx")`.

Una opción general para cargar bases de datos en RStudio es usar la librería `rio`. Esta librería permite importar, exportar y convertir diferentes tipos de archivos de datos, como Stata, SPSS, Excel, csv, SAS, RData, Minitab, dbf, entre muchos otros. Para esta web, esta libraría es útil dado que incluso permite importar bases de datos almacenadas en repositorios virtuales, como de GitHub.

A lo largo de estas secciones, se usarán bases de datos recortadas de la ronda 2018/19 por temas de espacio y también se usarán bases de datos en formato RData, un tipo de archivo de datos nativo de R y que es eficiente en términos de almacenamiento y que permite cargar la base de datos de la ronda 2018/19 con todas las variables.

Estas base de datos se encuentran alojadas en el repositorio "materials_edu" de la cuenta de LAPOP en [GitHub](https://github.com/lapop-central/materials_edu). Por ejemplo, para cargar una versión recortada de la base de datos de la ronda 2018/19, guardada en GitHub en formato SPSS, se puede cargar la libraría `rio` y llamar a esta base de datos remota con el comando `import`.

```{r importar GitHub}
library(rio) 
lapop18 <- import("https://raw.github.com/lapop-central/materials_edu/main/LAPOP_AB_Merge_2018_v1.0.sav")
```

De la misma manera, se puede usar esta librería para llamar a la base de datos completa, en formato RData, con el mismo comando.

```{r importar RData}
lapop18 <- import("https://raw.github.com/lapop-central/materials_edu/main/lapop18.RData")
```

# Resumen

En esta sección se ha explicado brevemente cómo descargar las bases de datos del Barómetro de las Américas, ya sea de una ronda completa o de algún país en particular. Luego, se ha explicado cómo definir un Proyecto en RStudio y cómo definir un directorio de trabajo. Es en este directorio donde se deben guardar las bases de datos descargadas para poder importarlas a RStudio. Esta importación se puede hacer usando principalmente la librería `haven` y la librería `rio`. Con estas librerías podemos importar múltiples formatos de bases de datos, incluyendo Stata, SPSS, csv, formatos en los que se pueden descargar las bases de datos del Barómetro de las Américas.
